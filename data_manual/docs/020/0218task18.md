# Database Maintenance

## Backup OIT Database
1. Log on to the OIT server following sub-task {doc}`../030/0301connect_oit`. Make sure you are login as root.
2. Enter the database docker container with the following command.
    ```
    docker exec -it spatempdb bash
    ```
3. Backup the database with the following command when you are in the container. You will see a list of errors. Ignore the errors it is expected.
    ```
    pg_dump -U chaos -Fc -f backup.bak spatempdb
    ```
4. Exit the container. By typing 'exit'.

5. Copy the backup file from the docker container using this command.
    ```
    docker cp spatempdb:backup.bak .
    ```
6. Copy the backup file to your own app folder.
    ```
    cp backup.bak /app/$YOUR_APP_FOLDER/backup/backup20211210.bak
    ```
7. On your laptop, open up a new terminal. Using the scp command copy the backup file onto your own computer current directory.
    ```
    scp YOURLOGIN@andlchaos300l.princeton.edu:/app/YOUR_APP_FOLDER/backup/backupYYYYMMDD.bak .
    ```

8.  Then upload the backup file to the chaos google drive folder. CHAOS Research -> frost_server_backup

9. You can then restore the database following these instructions <a href="https://chenkianwee.github.io/masa3db/docs/040/0411maintain.html" target="_blank">here</a>

## Server Down - Docker Restart Issue

1. Make sure you are logged in as root. Then use this command to start Docker
    ```
    systemctl start docker
    ```
2. Start all the containers with the following command.
    ```
    docker start spatempdb
    docker start frost
    docker start grafana
    ```
